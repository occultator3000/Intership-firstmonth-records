# å®ä¹ ä»»åŠ¡

## ç¬¬ä¸€ä¸ªæœˆï¼š

 ### 1ã€å¼€å‘ç¯å¢ƒæ­å»ºã€ç†Ÿæ‚‰gitä½¿ç”¨ã€ç†Ÿæ‚‰Charlesã€VS Codeã€Android Studioã€sourceTreeç­‰å·¥å…·çš„ä½¿ç”¨ 

### 2ã€RNå­¦ä¹ ï¼ŒæŒæ¡jsã€TypeScriptè¯­è¨€åŸºç¡€åŠè¯­æ³•

###  3ã€æ•´ç†å­¦ä¹ ç¬”è®°å¹¶æ€»ç»“å¿ƒå¾—ä½“ä¼š 

#### RNçš„å­¦ä¹ 

##### 1. React Native ç¯å¢ƒæ­å»º

**å­¦ä¹ æ–‡æ¡£å‚è€ƒï¼š**

[RNé¡¹ç›®å¿«é€Ÿä¸Šæ‰‹](https://github.com/reactnativecn/react-native-website/blob/production/archived_docs/version-0.68/_getting-started-macos-android.md)



- 1.1 HomeBrewã€Nodeã€Yarn/NPM ã€JDKã€Android Studioå®‰è£…

- 1.2 React Native CLI å®‰è£…ä¸åˆå§‹åŒ–é¡¹ç›®ï¼š`npx react-native init YOUR-PROJECT`

- 1.3 Android ç¯å¢ƒé…ç½®ï¼ˆXcodeã€Android Studioã€æ¨¡æ‹Ÿå™¨/çœŸæœºï¼‰
  
  - ä½¿ç”¨Virtual Device 
  - ä½¿ç”¨çœŸæœºè®¾å¤‡
    - é¡¹ç›®è¿è¡Œè°ƒè¯•ï¼š
    
    ~~~
    # æŸ¥çœ‹è®¾å¤‡
    adb devices
    
    # è¿è¡Œè®¾å¤‡
    npx react-native run-android
    
    #é€‰æ‹©è®¾å¤‡è¿è¡Œ
    npx react-native run-android --deviceId emulator-5554
    ~~~
    
    - æ‰‹æœºä¸ŠæŠ¥é”™è¯¯æŸ¥çœ‹ï¼š`adb logcat | grep -i react`
  
- 1.4 Metro æœåŠ¡ä¸ç¼“å­˜ç®¡ç†
  - å¼€å¯Metro 
  
    ~~~
    npx react-native start           # å¯åŠ¨ Metro
    npx react-native start --reset-cache  # å¼ºåˆ¶æ¸…ç†ç¼“å­˜
    ~~~
  
  - é¡¹ç›®å½»åº•æ¸…ç†å’Œé‡æ–°ç¼–è¯‘
  
    ~~~
    # 1. åˆ é™¤ node_modules
    rm -rf node_modules
    
    # 2. åˆ é™¤ android æ„å»ºç¼“å­˜
    rm -rf android/build
    rm -rf android/app/build
    
    # 3. å†æ¬¡å®‰è£…ä¾èµ–
    yarn install
    # æˆ– npm install
    
    # 4. æ¸…ç† gradle
    cd android
    ./gradlew clean
    cd ..
    
    # 5. é‡å¯ Metro
    npx react-native start --reset-cache
    
    # 6. é‡æ–°ç¼–è¯‘å®‰è£…
    npx react-native run-android
    ~~~
    
  - commands ï¼š
  
    ~~~
       r  - reload app(s)
       d  - open Dev Menu
       j  - open DevTools
    ~~~

##### 2. React Native ç»„ä»¶åŸºç¡€

**å­¦ä¹ æ–‡æ¡£å‚è€ƒï¼š**

[RNå®˜ç½‘](https://www.react-native.cn/docs/turbo-native-modules-introduction)

[React Hooks](https://zh-hans.react.dev/reference/react/hooks)

[ahooks](https://ahooks.js.org/zh-CN/hooks/use-request/basic)

###### 2.1 å¸¸ç”¨å†…ç½®ç»„ä»¶

- **Viewé‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼š**

1.**å†…å®¹è¢«é®æŒ¡æˆ–æ— æ³•æ»šåŠ¨**ï¼š
	æœ‰æ—¶çˆ¶å®¹å™¨æ²¡è®¾ç½®å¥½ `flex: 1`ï¼Œå¯¼è‡´å­ç»„ä»¶ç©ºé—´ä¸è¶³ï¼Œå‡ºç°é®æŒ¡æˆ–å†…å®¹æº¢å‡ºã€‚

2.`flex: 1`ã€`StyleSheet.absoluteFillObject` ç”¨æ³•å®¹æ˜“æ··æ·†ï¼Œå¯¼è‡´ç»„ä»¶ä¸æ˜¾ç¤ºæˆ–é®æŒ¡ã€‚

 	`flex: 1`ï¼šè®©ç»„ä»¶åœ¨çˆ¶å®¹å™¨é‡Œ**è‡ªåŠ¨å¡«æ»¡å‰©ä½™ç©ºé—´**ï¼Œé€‚åˆåšé¡µé¢ä¸»åŒºåŸŸå¸ƒå±€ã€‚

â€‹	`StyleSheet.absoluteFillObject`ï¼šè®©ç»„ä»¶**ç»å¯¹å¡«æ»¡çˆ¶å®¹å™¨**ï¼Œé€šå¸¸ç”¨äºåœ°å›¾ã€èƒŒæ™¯å›¾ç­‰éœ€è¦è¦†ç›–æ•´ä¸ªåŒºåŸŸçš„åœºæ™¯ã€‚

â€‹	`LocationPickerModal.js`é‡Œï¼Œ`MapView` ç”¨äº† `style={styles.map}`ï¼Œè€Œ `styles.map`æ˜¯ `StyleSheet.absoluteFillObject`ï¼Œä½†å¤–å±‚ `View`æ²¡æœ‰ `flex: 1`ï¼Œæˆ–è€…é«˜åº¦/å®½åº¦å—é™ï¼Œå¯¼è‡´åœ°å›¾æ˜¾ç¤ºå¼‚å¸¸ã€‚

- **Text ç»„ä»¶**

  1.åµŒå¥—åœ¨å¤šä¸ª View æˆ–è‡ªå®šä¹‰ç»„ä»¶é‡Œ,å¯èƒ½ä¼šè¢«çˆ¶ç»„ä»¶æ ·å¼è¦†ç›–æˆ–è€…ä¸ç”Ÿæ•ˆ

~~~javascript
<Text style={{
    fontWeight: 'bold',
    color: 'black',
    fontSize: 20,
}}>
    Pick Shop Location
</Text>
~~~

ç”¨ StyleSheet å•ç‹¬å®šä¹‰æ ·å¼ï¼Œé¿å…å†…è”æ ·å¼å†²çªã€‚

**åœ†è§’æ•ˆæœåªæœ‰åœ¨å…ƒç´ æœ‰èƒŒæ™¯è‰²æˆ–è¾¹æ¡†æ—¶æ‰èƒ½çœ‹åˆ°**

~~~javascript
const styles = StyleSheet.create({
    container: {
        ...StyleSheet.absoluteFillObject,
        height: 400,
        width: 400,
        justifyContent: 'center',
        alignItems: 'center',
    },
    text: {
        fontWeight: 'bold',
    		color: 'black',
    		fontSize: 20,
    },
});
~~~

**é”®ç›˜è¦†ç›–é¡µé¢è®¾ç½®ï¼š**

AndroidManifest.xmlä¸­ä¿®æ”¹ï¼šadjustResize->asjustPanï¼Œåœ¨å¡«å†™è¡¨å•æ—¶å°±ä¸ä¼šæŒ¤å‹è¡¨å•

~~~xml
<Activity>
  android:windowSoftInputMode="adjustPan"
</Activity>
~~~



- **ScrollView**
  - **æ»šåŠ¨åŒºåŸŸä¸ç”Ÿæ•ˆ**ï¼š`flex: 1` å’Œ `contentContainerStyle` é…åˆä¸å½“ï¼Œå¯¼è‡´å†…å®¹æ— æ³•æ»šåŠ¨ã€‚
  - **åµŒå¥— FlatList/ScrollView**ï¼šå¤šå±‚åµŒå¥—æ—¶æ»šåŠ¨å†²çªã€‚

æ­£ç¡®å†™æ³•ï¼š

~~~javascript
<ScrollView
  style={{ flex: 1 }}
  contentContainerStyle={{ padding: 16 }}
>
  {/* å†…å®¹ */}
</ScrollView>
~~~

~~~javascript
<ScrollView style={{ flex: 1 }}>
  {/* å…¶ä»–å†…å®¹ */}
  <FlatList
    scrollEnabled={false} // ç¦æ­¢å†…å±‚æ»šåŠ¨,å¯ä»¥è§£å†³ä¸å¤–å±‚æ»šåŠ¨çš„å†²çª
    data={data}
    renderItem={...}
  />
</ScrollView>
~~~



###### 2.2 ç¬¬ä¸‰æ–¹ç»„ä»¶åº“

â€‹	**ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶æ—¶éœ€è¦æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œè¿›è¡Œä¾èµ–çš„å®‰è£…ä»¥åŠé…ç½®ï¼Œéœ€è¦è§£å†³ä¾èµ–å†²çªï¼Œç‰ˆæœ¬ä¸å…¼å®¹ç­‰é—®é¢˜**

- iconså‡ºç°å›¾æ ‡ä¸æ˜¾ç¤ºï¼ŒåŸå› ï¼šimport æ—¶ä¸ºæ­£ç¡®å¯¼å…¥@react-native-vector-icons/inoiconsï¼Œåº”æ£€æŸ¥ import å’Œç»„ä»¶å‘½åï¼Œç¡®ä¿å’Œåº“æ–‡æ¡£ä¸€è‡´ï¼Œä»¥åŠå®˜æ–¹æœ‰react-native-vector-iconsåº“ï¼Œä¸å‰ç¼€@ä¸æ˜¯ç›¸åŒçš„ï¼Œéœ€è¦è¾¨åˆ«ä¹¦å†™ã€‚
- ä¾èµ–å†²çªï¼ˆå¦‚ @amap å’Œ amapï¼‰
  - **åŸå› **ï¼šé¡¹ç›®é‡ŒåŒæ—¶å®‰è£…äº†ä¸¤ä¸ªç±»ä¼¼çš„é«˜å¾·åœ°å›¾åº“ï¼Œå¯¼è‡´åŸç”Ÿæ¨¡å—æ³¨å†Œé‡å¤ï¼ˆå¦‚ `AMapCircle`ï¼‰ï¼Œå‡ºç°ç¨‹åºå´©æºƒé€€å‡ºã€‚
  - **è§£å†³æ–¹æ³•**ï¼šåªä¿ç•™ä¸€ä¸ªåœ°å›¾åº“ï¼Œå¸è½½å¤šä½™ä¾èµ–ï¼Œå½»åº•æ¸…ç† node_modules å’Œ android/buildï¼Œå†é‡æ–°ç¼–è¯‘ã€‚æ³¨æ„æŠŠç›¸å…³å¯¼å…¥ä»£ç ä¹¦å†™æ­£ç¡®ï¼Œå¦åˆ™ä¾ç„¶ç¼–è¯‘é”™è¯¯ã€‚
- ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶åº“æ—¶å¼•ç”¨éœ€è¦åŠ {},å¦åˆ™ä¸ç”Ÿæ•ˆï¼Œæ¯”å¦‚ `import {AMapSdk} from 'react-native-amap3d'`
- `react-native-amap3d` åœ¨ Modal å…³é—­æ—¶èµ„æºé‡Šæ”¾ä¸å½»åº•ï¼Œå¯¼è‡´é—ªé€€:

**é«˜å¾·åœ°å›¾åŸç”Ÿ SDK åœ¨é”€æ¯åœ°å›¾å¼•æ“æ—¶å´©æºƒäº†ã€‚**
è¿™ä¸æ˜¯ JS ä»£ç é—®é¢˜ï¼Œæ˜¯ react-native-amap3d æˆ–é«˜å¾·åœ°å›¾åŸç”Ÿåº“çš„ bugï¼Œå°¤å…¶æ˜¯åœ¨ Modal é‡ŒåŠ¨æ€å¸è½½ `<MapView />` æ—¶ã€‚

**ä¸»è¦åŸå› **ï¼š**é«˜å¾·åœ°å›¾åŸç”Ÿ SDK åœ¨ Modal å…³é—­æ—¶ï¼ŒMapView ç»„ä»¶è¢«å¸è½½ï¼ŒåŸç”Ÿèµ„æºé‡Šæ”¾é¡ºåºæˆ–æ—¶æœºæœ‰ bugï¼Œå¯¼è‡´ native å´©æºƒã€‚**

**è§£å†³æ–¹æ¡ˆï¼š**

1.æ›´æ–°æœ€æ–°amap

2.åœ¨`project/android/app/src/main/AndroidManifest.xml`çš„`application` èŠ‚ç‚¹ä¸‹æ–°å¢

~~~xml
<Application
android:allowNativeHeapPointerTagging="false">
***å…¶ä»–ä»£ç ***
</Application>
~~~



###### 2.3 è‡ªå®šä¹‰ç»„ä»¶å¼€å‘ä¸å¤ç”¨

å¤ç”¨æŒ‰é’®ç»„ä»¶ï¼š

~~~javascript
import { View, Text, TouchableOpacity } from 'react-native';
import React from 'react';
import Ionicons from 'react-native-vector-icons/Ionicons';


export default function SelectionComp({ extraStyle, image, label, onPress, checked }) {
    return (
        <TouchableOpacity style={{ flex: 1 }} onPress={() => onPress()}>
            <View style={[
                {
                    borderColor: '#BEC2C3',
                    borderWidth: 1,
                    paddingHorizontal: 15,
                    paddingVertical: 10,
                    borderRadius: 20,
                    flexDirection: 'row',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                },
                extraStyle,
            ]}>
                <View>
                    <Text style={{color:'#494a4a'}}>{label}</Text>
                </View>
                <View style={{ flexDirection: 'row', alignItems: 'center' }}>
                    {checked ?
                        <Ionicons
                            name='checkmark-circle'
                            iconStyle='solid'
                            color={'green'}
                            size={20}
                            style={{ marginRight: 10 }}
                        /> : null}
                    {image}
                </View>
            </View>
        </TouchableOpacity>
    );
}
~~~

åœ¨MyShopScreenä»£ç ä¸­å¤ç”¨ï¼Œåªéœ€ä¼ é€’ä¸åŒå‚æ•°ï¼Œå°±èƒ½æ»¡è¶³ä¸åŒä¸šåŠ¡åœºæ™¯ï¼š

~~~javascript
import SelectionComp from '../../components/SelectionComp';
// ...å…¶ä»– import

export default function MyShopScreen({ navigation }) {
    // ...çœç•¥éƒ¨åˆ†çŠ¶æ€å’Œæ–¹æ³•

    return (
        <View style={{ flex: 1 }}>
            {/* ...å…¶ä»–é¡µé¢å†…å®¹ */}
            <View style={{ flex: 1, padding: 15 }}>
                {/* ç»Ÿä¸€è¾“å…¥æ¡† */}
                <FormInputText placeholder={'Name'} />
                <FormInputText placeholder={'Email'} extraStyle={{ marginTop: 10 }} />
                <FormInputText placeholder={'Phone'} extraStyle={{ marginTop: 10 }} />
                <FormInputText placeholder={'Address'} extraStyle={{ marginTop: 10 }} />

                {/* å¤ç”¨ SelectionComp ç»„ä»¶ï¼Œä¼ é€’ä¸åŒçš„ props å®ç°ä¸åŒåŠŸèƒ½ */}
                <SelectionComp
                    label={'Upload Shop Image'}
                    image={<Ionicons name='image-sharp' size={20} />}
                    extraStyle={{ marginTop: 20 }}
                    onPress={() => pickImageFromGallery()}
                    checked={shopImage ? true : false}
                />
                <SelectionComp
                    label={'Upload Shop Owner Image'}
                    image={<Ionicons name='image-sharp' size={20} />}
                    extraStyle={{ marginTop: 20 }}
                    onPress={() => pickShopOwnerImageFromGallery()}
                    checked={shopOwnerImage ? true : false}
                />
                <SelectionComp
                    label={shopCategory === undefined ? 'Select Category' : 'Selected Category - ' + shopCategory}
                    image={<Ionicons name='chevron-down' size={21} />}
                    extraStyle={{ marginTop: 20 }}
                    onPress={() => refRBSheet.current.open()}
                />
                <SelectionComp
                    label={'Select Shop Location'}
                    image={<Ionicons name='location-sharp' size={21} />}
                    extraStyle={{ marginTop: 20 }}
                    onPress={() => console.log('Press')}
                />
                <SelectionComp
                    label={shopOpenTime === undefined ? 'Open Time' : 'Open Time - ' + shopOpenTime}
                    image={<Ionicons name='time' size={18} />}
                    extraStyle={{ marginTop: 20 }}
                    onPress={() => {
                        setCurrentTimeOption('open');
                        setOpenDatePicker(true);
                    }}
                    checked={shopOpenTime ? true : false}
                />
                <SelectionComp
                    label={shopCloseTime === undefined ? 'Close Time' : 'Close Time - ' + shopCloseTime}
                    image={<Ionicons name='time' size={18} />}
                    extraStyle={{ marginTop: 20 }}
                    onPress={() => {
                        setCurrentTimeOption('close');
                        setOpenDatePicker(true);
                    }}
                    checked={shopCloseTime ? true : false}
                />
            </View>
            {/* ...å…¶ä»–é¡µé¢å†…å®¹ */}
        </View>
    );
}
~~~



##### 3. React Hooks å­¦ä¹ 

- 3.1 useStateã€useEffectç­‰åŸºç¡€å­¦ä¹ 

**useState**

ç”¨æ¥å£°æ˜å’Œç®¡ç†ç»„ä»¶é‡Œçš„çŠ¶æ€å˜é‡ã€‚
æ¯”å¦‚ï¼š

~~~javascript
const [showLocation, setShowLocation] = useState(false);
const [shopImage, setshopImage] = useState();
~~~

ç”¨ setXXX ä¿®æ”¹çŠ¶æ€ï¼ŒçŠ¶æ€å˜äº†é¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°ã€‚

**useEffect**

ç”¨æ¥åšå‰¯ä½œç”¨ï¼Œæ¯”å¦‚é¡µé¢åˆå§‹åŒ–ã€è¯·æ±‚æ•°æ®ç­‰ã€‚
æ¯”å¦‚ï¼š

~~~javascript
useEffect(() => {
 getUserData();
}, []);
~~~

ä¾èµ–æ•°ç»„æ˜¯ []ï¼Œåªåœ¨é¡µé¢ç¬¬ä¸€æ¬¡åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚

**useRef**

ç”¨æ¥è·å–ç»„ä»¶å®ä¾‹æˆ–è€…ä¿å­˜,ä¸ä¼šå¼•èµ·é¡µé¢åˆ·æ–°çš„å˜é‡ã€‚
æ¯”å¦‚ï¼š

~~~javascript
const refRBSheet = useRef();
~~~

å¯ä»¥ç”¨ refRBSheet.current è°ƒç”¨åº•éƒ¨å¼¹çª—çš„æ–¹æ³•ã€‚

åœ¨ç¼–å†™çš„demoä¸­çš„ä½¿ç”¨:

~~~javascript
//MyShopScreen
import React, { useState, useEffect, useRef } from 'react';
import { View, Text, StatusBar, Dimensions, TouchableOpacity } from 'react-native';
import AppToolBar from '../../components/AppToolBar';
import RBSheet from 'react-native-raw-bottom-sheet';
import LocationPickerModal from '../../modals/LocationPickerModal';
import SelectionComp from '../../components/SelectionComp';
import Ionicons from 'react-native-vector-icons/Ionicons';
import DatePicker from 'react-native-date-picker';
import { formatDate } from '../../config/datePicker';

export default function MyShopScreen({ navigation }) {
    // 1. useState ç”¨äºç®¡ç†å„ç§çŠ¶æ€
    const [user, setUser] = useState();
    const [shopImage, setshopImage] = useState();
    const [shopOwnerImage, setShopOwnerImage] = useState();
    const [shopCategory, setshopCategory] = useState();
    const [showLocation, setShowLocation] = useState(false);
    const [openDatePicker, setOpenDatePicker] = useState(false);
    const [shopOpenTime, setShopOpenTime] = useState();
    const [shopCloseTime, setShopCloseTime] = useState();
    const [currentTimeOption, setCurrentTimeOption] = useState();

    // 2. useRef ç”¨äºè·å–åº•éƒ¨å¼¹çª—å®ä¾‹
    const refRBSheet = useRef();

    // 3. useEffect ç”¨äºåˆå§‹åŒ–æ•°æ®
    useEffect(() => {
        getUserData();
    }, []);

    // ä¸šåŠ¡ç›¸å…³å‡½æ•°ç•¥...

    // 4. ç»“åˆ useState/useRef çš„ä¸šåŠ¡ç»„ä»¶
    const SelectGategoryBs = () => (
        <RBSheet ref={refRBSheet} ...>
            {/* ...å†…å®¹ç•¥... */}
        </RBSheet>
    );

    return (
        <View style={{ flex: 1 }}>
            <StatusBar backgroundColor="#e3d2c2" barStyle="light-content" />
            <AppToolBar navigation={navigation} label={"MyShop"} />
            <SelectGategoryBs />
            {/* 5. ç”¨ useState æ§åˆ¶å¼¹çª—æ˜¾ç¤º */}
            {showLocation && (
                <LocationPickerModal visible={true} onclose={() => setShowLocation(false)} />
            )}
            <DatePicker
                modal
                mode='time'
                open={openDatePicker}
                date={new Date()}
                onConfirm={(date) => {
                    setOpenDatePicker(false)
                    if (currentTimeOption === 'open') {
                        setShopOpenTime(formatDate(date.getHours() + ':' + date.getMinutes()));
                    } else if (currentTimeOption === 'close') {
                        setShopCloseTime(formatDate(date.getHours() + ':' + date.getMinutes()));
                    }
                }}
                onCancel={() => setOpenDatePicker(false)}
            />
            {/* å…¶ä»–è¡¨å•å’Œä¸šåŠ¡å†…å®¹ç•¥ */}
        </View>
    );
}
~~~

**useCallback**

**ä½œç”¨**ï¼šè¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„å›è°ƒå‡½æ•°ï¼Œåªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰ä¼šé‡æ–°ç”Ÿæˆã€‚

~~~javascript
const handleSelect = useCallback(() => {

  setShowLocation(true);

}, []);
~~~

- ç”¨äºä¼˜åŒ–æ€§èƒ½ï¼Œé¿å…å­ç»„ä»¶é‡å¤æ¸²æŸ“ã€‚
- ä¼ é€’ç»™å­ç»„ä»¶çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚

**useMemo**

**ä½œç”¨**ï¼šè¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„å€¼ï¼Œåªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰ä¼šé‡æ–°è®¡ç®—ï¼Œç”¨äºä¼˜åŒ–æ€§èƒ½ï¼Œé¿å…ä¸å¿…è¦çš„é‡å¤è®¡ç®—ï¼Œå¤„ç†å¤æ‚è®¡ç®—æˆ–å¤§æ•°æ®é‡ç­›é€‰ã€‚

~~~javascript
const filteredCategory = useMemo(() => {
  return CategoryLs.filter(item => item.name.includes(searchText));
}, [searchText]);
~~~



- 3.2 è‡ªå®šä¹‰ Hook çš„ç¼–å†™ä¸åº”ç”¨

###### React Native åŠ¨ç”»ä¸çŠ¶æ€ç®¡ç†ç¬”è®°

**1. Animated.Value ä¸ scrollx**

åœ¨ React Native ä¸­ï¼Œ`Animated.Value` ç”¨äºåˆ›å»ºå¯åŠ¨ç”»é©±åŠ¨çš„æ•°å€¼ã€‚æ¯”å¦‚ï¼š

```js
const scrollx = new Animated.Value(0);
```

è¿™é‡Œçš„ `0` æ˜¯åŠ¨ç”»å€¼çš„åˆå§‹å€¼ï¼Œè¡¨ç¤ºåŠ¨ç”»å˜é‡ä» 0 å¼€å§‹å˜åŒ–ã€‚è¯¥å€¼ä¸€èˆ¬ç”¨æ¥ç›‘å¬ç»„ä»¶çš„æ»‘åŠ¨åç§»æˆ–é©±åŠ¨å…¶ä»–åŠ¨ç”»å±æ€§ã€‚

å½“ç”¨åˆ†é¡µçš„ FlatList æ—¶ï¼Œ`scrollx` å¯ä»¥åæ˜ å½“å‰æ¨ªå‘æ»šåŠ¨è·ç¦»ï¼Œé…åˆ `Animated.event`ï¼Œå®ç°æ»‘åŠ¨æ—¶çš„åŠ¨æ€åŠ¨ç”»æ•ˆæœã€‚

**2. useRef çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯**

`useRef` æ˜¯ Reactï¼ˆåŒ…æ‹¬ React Nativeï¼‰æä¾›çš„ Hookï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªæŒä¹…ä¸”å¯å˜çš„å¼•ç”¨å¯¹è±¡ï¼Œç»“æ„æ˜¯ `{ current: åˆå§‹å€¼ }`ã€‚

ä¿®æ”¹ `.current` ä¸ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè¿™ä½¿å¾—å®ƒé€‚åˆç”¨æ¥ä¿å­˜ï¼š

- ç»„ä»¶å®ä¾‹å¼•ç”¨ï¼Œä¾‹å¦‚ FlatList çš„ `ref`ï¼Œç”¨äºè°ƒç”¨æ»šåŠ¨ç­‰æ–¹æ³•ã€‚
- åŠ¨ç”»å¯¹è±¡ï¼Œä¾‹å¦‚ `Animated.Value`ï¼Œä¿è¯åŠ¨ç”»å€¼åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…å”¯ä¸€ä¸”æŒç»­ã€‚
- éœ€è¦è·¨æ¸²æŸ“å‘¨æœŸä¿å­˜ä½†ä¸ç›´æ¥å½±å“ UI çš„æ•°æ®ï¼Œæ¯”å¦‚å®šæ—¶å™¨ IDã€ç¼“å­˜å€¼ç­‰ã€‚

ä¸ `useState` ä¸åŒçš„æ˜¯ï¼Œ`useState` ä¿®æ”¹çŠ¶æ€ä¼šå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè€Œ `useRef` ä¿®æ”¹ `.current` ä¸ä¼šã€‚

**3. useRef ä¸ useState çš„åŒºåˆ«**

`useState` ç”¨äºç®¡ç†çŠ¶æ€ï¼ŒçŠ¶æ€æ”¹å˜åç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“ï¼Œè¿™é€‚åˆ UI éœ€è¦å“åº”çš„å˜é‡ã€‚å…¸å‹å¦‚è®¡æ•°å™¨ã€è¾“å…¥æ¡†å†…å®¹ã€æ¥å£æ•°æ®ç­‰ã€‚

è€Œ `useRef` ç”¨æ¥ä¿å­˜ä¸å½±å“ UI å±•ç¤ºçš„å¯å˜å€¼ï¼Œæ¯”å¦‚åŠ¨ç”»å€¼ã€å¼•ç”¨ã€å®šæ—¶å™¨ ID ç­‰ã€‚å®ƒèƒ½é¿å…ä¸å¿…è¦çš„æ¸²æŸ“ï¼Œæå‡æ€§èƒ½ã€‚

æ€»ç»“æ¥è¯´ï¼Œå‡¡æ˜¯éœ€è¦å½±å“ç•Œé¢æ˜¾ç¤ºçš„å€¼ï¼Œä½¿ç”¨ `useState`ï¼›å‡¡æ˜¯çº¯ç²¹æ•°æ®ç¼“å­˜æˆ–å¼•ç”¨ï¼Œä½¿ç”¨ `useRef`ã€‚

**4. FlatList æ»šåŠ¨ç›‘å¬ä¸åˆ†é¡µæŒ‡ç¤ºå™¨çš„å®ç°**

åœ¨å®ç°åˆ†é¡µæŒ‡ç¤ºå™¨æ—¶ï¼Œç»å¸¸ç”¨ `Animated.Value` æ¥ç›‘å¬ FlatList çš„æ»šåŠ¨åç§»ï¼š

```js
const scrollx = useRef(new Animated.Value(0)).current;

<Animated.FlatList
  onScroll={Animated.event(
    [{ nativeEvent: { contentOffset: { x: scrollx } } }],
    { useNativeDriver: false }
  )}
  pagingEnabled
  horizontal
  // å…¶ä»–å±æ€§
/>
```

è¿™é‡Œ `nativeEvent.contentOffset.x` è¡¨ç¤ºæ¨ªå‘æ»šåŠ¨è·ç¦»ï¼Œç»‘å®šåˆ°åŠ¨ç”»å€¼ `scrollx`ï¼Œé€šè¿‡å®ƒé©±åŠ¨æŒ‡ç¤ºå™¨çš„åŠ¨ç”»ã€‚

åˆ†é¡µæŒ‡ç¤ºå™¨ç»„ä»¶ä¸­ï¼Œæ¯ä¸ªåœ†ç‚¹çš„åŠ¨ç”»é€šè¿‡æ’å€¼å®ç°ï¼š

```js
const inputRange = [(i - 1) * width, i * width, (i + 1) * width];
const scale = scrollx.interpolate({
  inputRange,
  outputRange: [0.8, 1.4, 0.8],
  extrapolate: 'clamp',
});
const opacity = scrollx.interpolate({
  inputRange,
  outputRange: [0.6, 0.9, 0.8],
  extrapolate: 'clamp',
});
```

è¿™é‡Œ `inputRange` ä¸­çš„ä¸‰ä¸ªå€¼åˆ†åˆ«ä»£è¡¨å½“å‰é¡µå‰ä¸€é¡µã€å½“å‰é¡µå’Œåä¸€é¡µçš„æ»‘åŠ¨åç§»ä½ç½®ï¼Œ`scrollx` åœ¨è¯¥åŒºé—´å†…å˜åŒ–æ—¶ï¼ŒåŠ¨ç”»å±æ€§å¹³æ»‘è¿‡æ¸¡ã€‚

`extrapolate: 'clamp'` ç¡®ä¿å½“æ»šåŠ¨è¶…å‡ºèŒƒå›´æ—¶ï¼ŒåŠ¨ç”»ä¸ä¼šç»§ç»­æ‰©å±•ã€‚

**5. transform å’Œ opacity ç­‰åŠ¨ç”»å±æ€§çš„å†™æ³•**

åœ¨ç»™æ ·å¼æ·»åŠ åŠ¨ç”»æ—¶ï¼Œ`transform` å±æ€§å¿…é¡»æ˜¯æ•°ç»„ï¼Œå› ä¸ºå®ƒæ”¯æŒå¤šé‡åŠ¨ç”»ç»„åˆï¼Œå¦‚ç¼©æ”¾ã€æ—‹è½¬ã€å¹³ç§»ï¼š

```js
transform: [{ scale }]
```

è€Œ `opacity` ç­‰æ™®é€šæ ·å¼å±æ€§ï¼Œç›´æ¥å†™æˆæ•°å€¼æˆ–åŠ¨ç”»å€¼å³å¯ï¼š

```js
opacity: opacity
```

ä¸éœ€è¦ä¹Ÿä¸åº”è¯¥ç”¨æ•°ç»„åŒ…è£¹ï¼Œå¦åˆ™åŠ¨ç”»ä¸ä¼šç”Ÿæ•ˆã€‚

**6. FlatList å¼•ç”¨ä¸æ§åˆ¶**

ä½¿ç”¨ `useRef` åˆ›å»ºä¸€ä¸ªå¼•ç”¨ï¼Œç»‘å®š FlatListï¼š

```js
const slideRef = useRef(null);

<FlatList ref={slideRef} />
```

é€šè¿‡å¼•ç”¨å¯ä»¥è°ƒç”¨ FlatList çš„æ–¹æ³•ï¼Œå¦‚æ»šåŠ¨åˆ°æŒ‡å®šé¡µï¼š

```js
slideRef.current.scrollToIndex({ index: currentIndex + 1 });
```

è¿™æ–¹ä¾¿å®ç°â€œä¸‹ä¸€é¡µâ€ç­‰äº¤äº’åŠŸèƒ½ã€‚

**7. ä»€ä¹ˆæ—¶å€™éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œä»€ä¹ˆæ—¶å€™ä¸éœ€è¦**

åªè¦å˜é‡ä¼šå½±å“ UI å±•ç¤ºï¼Œæ¯”å¦‚è®¡æ•°ã€æ–‡æœ¬ã€é¢œè‰²ç­‰ï¼Œå°±éœ€è¦ç”¨ `useState`ï¼Œä¿®æ”¹å®ƒä¼šå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

è€Œå¦‚æœæ˜¯çº¯ç²¹ç”¨æ¥ç¼“å­˜æ•°æ®ã€ä¸ç›´æ¥å½±å“ç•Œé¢ã€æˆ–è€…å¼•ç”¨ç»„ä»¶å®ä¾‹ï¼Œä½¿ç”¨ `useRef`ï¼Œä¿®æ”¹ä¸ä¼šè§¦å‘æ¸²æŸ“ï¼Œé¿å…ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚

**æ€»ç»“**

- `Animated.Value(0)` ç”¨æ¥åˆ›å»ºå¸¦åŠ¨ç”»æ•ˆæœçš„æ•°å€¼ï¼Œ`0` æ˜¯åˆå§‹å€¼ã€‚
- `useRef` ç”¨æ¥åˆ›å»ºæŒç»­ä¸å˜çš„å¼•ç”¨ï¼Œä¿å­˜ä¸å½±å“ UI çš„æ•°æ®æˆ–ç»„ä»¶å®ä¾‹ã€‚
- `useState` ç”¨æ¥ç®¡ç†ä¼šå½±å“ UI æ˜¾ç¤ºçš„çŠ¶æ€ã€‚
- æ»šåŠ¨ç›‘å¬é€šè¿‡ç»‘å®š FlatList çš„ `nativeEvent.contentOffset.x` åˆ°åŠ¨ç”»å€¼å®ç°ã€‚
- åˆ†é¡µæŒ‡ç¤ºå™¨çš„åŠ¨ç”»é€šè¿‡ `scrollx.interpolate` æ ¹æ®æ»‘åŠ¨ä½ç½®å¹³æ»‘è¿‡æ¸¡ã€‚
- `transform` æ˜¯æ•°ç»„å½¢å¼çš„æ ·å¼ï¼Œæ™®é€šæ ·å¼å¦‚ `opacity` æ˜¯ç›´æ¥æ•°å€¼ã€‚
- FlatList é€šè¿‡ `useRef` å¼•ç”¨ï¼Œå¯ä»¥è°ƒç”¨æ»šåŠ¨ç­‰æ–¹æ³•å®ç°äº¤äº’ã€‚

------

- 3.3 ç”Ÿå‘½å‘¨æœŸä¸æ•°æ®æµç®¡ç†

##### 4. è·¯ç”±ä¸å¯¼èˆª

- 4.1 react-navigation 



- 4.2 Drawerã€Stackã€Tab å¯¼èˆªç”¨æ³•



- 4.3 é¡µé¢å‚æ•°ä¼ é€’ä¸è¿”å›



##### 5. åŸç”Ÿæ¨¡å—ä¸ Codegen

**å­¦ä¹ æ–‡æ¡£**ï¼š

[RN-NativeåŸºç¡€Bridgeè¯´æ˜](https://pupumall.feishu.cn/wiki/P00PwQbR9ivVJPklAPNcw8zhnnc)

- 5.1 åŸç”Ÿæ¨¡å—æ¡¥æ¥åŸç†

åœ¨é«˜å¾·åœ°å›¾ä¸­ï¼Œç”±äºamapä¸èƒ½å¤Ÿå®ç°é€†åœ°ç†ç¼–ç ï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦æŒ‰ç…§é«˜å¾·åœ°å›¾æ–‡æ¡£å»ä½¿ç”¨åŸç”Ÿä»£ç å®ç°é€†åœ°ç†ç¼–ç åŠŸèƒ½å¹¶æ¡¥æ¥åˆ°RNï¼ˆä½†æ˜¯amapå’Œ3dmapæœ‰ä¾èµ–å†²çªï¼Œè¿™é‡ŒèŠ±å¾ˆå¤šæ—¶é—´è§£å†³

â€‹	(1) é¦–å…ˆæ˜¯é…ç½®é«˜å¾·åœ°å›¾æœç´¢SDKï¼Œåˆ†åˆ«åœ¨android/build.gradleå’Œandroid/app/build.gradleè¿›è¡Œå®˜ç½‘æŒ‡å¯¼çš„ç›¸å…³é…ç½®

~~~
//android/build.gradle
allprojects {
    repositories {
        //google()
        mavenCentral()

        // âœ… æ·»åŠ é«˜å¾·çš„ Maven ä»“åº“
        maven { url 'https://a.amap.com/android/sdk/maven' }
    }
}

//android/app/build.gradle
android{
	ndk {
            //è®¾ç½®æ”¯æŒçš„SOåº“æ¶æ„ï¼ˆå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€è¦ï¼Œé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªå¹³å°çš„soï¼‰
            abiFilters  "armeabi-v7a", "arm64-v8a"
        }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    //3Dåœ°å›¾soåŠjar,å·²ç»åŒ…å«å®šä½å’Œæœç´¢åŠŸèƒ½æ— éœ€å•ç‹¬å¼•ç”¨
    implementation 'com.amap.api:search:latest.integration'
     
}
~~~

â€‹	(2) åœ¨android/app/src/main/java/com/yteeeecommerceç›®å½•ä¸‹åˆ›å»ºjavaæ–‡ä»¶æˆ–è€…ktæ–‡ä»¶

~~~java
//AMapGeocodeModule.java
package com.yteeeecommerce;

import ...

public class AMapGeocodeModule extends ReactContextBaseJavaModule {
    private final ReactApplicationContext reactContext;

    public AMapGeocodeModule(ReactApplicationContext reactContext) {
        super(reactContext);
        this.reactContext = reactContext;
    }

    @NonNull
    @Override
    public String getName() {
        return "AMapGeocodeModule";
    }
		
  	// è·å–åœ°å€ä¿¡æ¯
    @ReactMethod
    public void getAddress(double latitude, double longitude, Promise promise) {
        try {
            GeocodeSearch geocodeSearch = new GeocodeSearch(reactContext);
            geocodeSearch.setOnGeocodeSearchListener(new GeocodeSearch.OnGeocodeSearchListener() {
                @Override
                public void onRegeocodeSearched(RegeocodeResult result, int rCode) {
                    Log.d("AMapGeocodeModule", "onRegeocodeSearched: rCode = " + rCode);
                    if (rCode == AMapException.CODE_AMAP_SUCCESS &&
                        result.getRegeocodeAddress() != null) {
                        String address = result.getRegeocodeAddress().getFormatAddress();
                        promise.resolve(address);
                    } else {
                        promise.reject("AMAP_ERROR", "é€†åœ°ç†ç¼–ç å¤±è´¥ï¼Œé”™è¯¯ç : " + rCode);
                    }
                }

                @Override
                public void onGeocodeSearched(GeocodeResult result, int rCode) {}
            });

            LatLonPoint point = new LatLonPoint(latitude, longitude);
            RegeocodeQuery query = new RegeocodeQuery(point, 200, GeocodeSearch.AMAP);
            geocodeSearch.getFromLocationAsyn(query);
        } catch (Exception e) {
            promise.reject("AMAP_EXCEPTION", e.getMessage());
        }
    }
}

~~~

~~~java
//AmapGeocodePackage.java
package com.yteeeecommerce;

import ...

//è¿™ä¸ªç±»ç”¨äºæ³¨å†Œ AMapGeocodeModule æ¨¡å—åˆ° React Native
public class AMapGeocodePackage implements ReactPackage {
    @Override
    public List<NativeModule> createNativeModules(ReactApplicationContext context) {
        return Arrays.<NativeModule>asList(new AMapGeocodeModule(context));
    }

    @Override
    public List<ViewManager> createViewManagers(ReactApplicationContext context) {
        return Collections.emptyList();
    }
}

~~~

ç„¶ååœ¨MainApplication.ktä¸­æ³¨å†Œæ¨¡å—,è¿˜éœ€å†onCreate()ä¸­åˆå§‹åŒ–

~~~kotlin
//é¡¶éƒ¨å¯¼å…¥æ¨¡å—
import com.yteeeecommerce.AMapGeocodePackage
/*å…¶ä»–å¯¼å…¥å†…å®¹*/

//æ³¨å†Œ
class MainApplication : Application(), ReactApplication {

  override val reactNativeHost: ReactNativeHost =
      object : DefaultReactNativeHost(this) {
        override fun getPackages(): List<ReactPackage> =
            PackageList(this).packages.apply {
              // Packages that cannot be autolinked yet can be added manually here, for example:
              // add(MyReactNativePackage())
              add(AMapGeocodePackage())//æ·»åŠ è¿™ä¸€è¡Œ
            }

        //å…¶ä»–ä»£ç 
        
    override fun onCreate() {
    	super.onCreate()

    	// âœ… é«˜å¾·åœ°å›¾éšç§åˆè§„åˆå§‹åŒ–
    	ServiceSettings.updatePrivacyShow(this, true, true);
    	ServiceSettings.updatePrivacyAgree(this, true);
    
    	loadReactNative(this)
      }
}

~~~

â€‹	(3)åœ¨é¡¹ç›®ä¸­ä½¿ç”¨

~~~javascript
import {  NativeModules } from 'react-native';
/*å…¶ä»–*/

const { AMapGeocodeModule } = NativeModules;

async function getAddress() {
        try {
            const address = await AMapGeocodeModule.getAddress(marker.latitude, marker.longitude);
            console.log('åœ°å€', address);
        } catch (error) {
            console.error('é€†åœ°ç†ç¼–ç å¤±è´¥', error);
        }
    }
~~~



- 5.2 Codegen è‡ªåŠ¨ç”ŸæˆåŸç”Ÿæ¡¥æ¥ä»£ç 





- 5.3 è‡ªå®šä¹‰åŸç”Ÿç»„ä»¶ï¼ˆAndroid/iOSï¼‰





- 5.4 åŸç”Ÿä¾èµ–ç®¡ç†ä¸ ABI å…¼å®¹æ€§





##### 6. æƒé™ä¸å¹³å°ç‰¹æ€§

- 6.1 Androidæƒé™ç”³è¯·ï¼ˆå¦‚å®šä½ã€å­˜å‚¨ã€ç›¸æœºï¼‰

**æƒé™å£°æ˜ï¼ˆAndroidManifest.xmlï¼‰**

åœ¨ [android/app/src/main/AndroidManifest.xml](vscode-file://vscode-app/private/var/folders/zd/1f6lczvn43g25g0y_tbs__hm0000gn/T/AppTranslocation/54DE840E-F764-4ABF-9A7A-C46E274080C2/d/Visual Studio Code.app/Contents/Resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) é‡ŒåŠ ä¸Šéœ€è¦çš„æƒé™ï¼š

~~~xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
~~~

**åŠ¨æ€æƒé™ç”³è¯·ï¼ˆJSä»£ç é‡Œï¼‰**

ç”¨ [PermissionsAndroid](vscode-file://vscode-app/private/var/folders/zd/1f6lczvn43g25g0y_tbs__hm0000gn/T/AppTranslocation/54DE840E-F764-4ABF-9A7A-C46E274080C2/d/Visual Studio Code.app/Contents/Resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) ç”³è¯·æ•æ„Ÿæƒé™ï¼ˆå¦‚å®šä½ã€å­˜å‚¨ã€ç›¸æœºï¼‰ï¼Œå¦åˆ™ Android 6.0+ ä¸Šä¼šè¢«æ‹’ç»ã€‚

**å®šä½æƒé™ç”³è¯·**

~~~javascript
import { PermissionsAndroid, Platform } from 'react-native';

async function requestLocationPermission() {
  if (Platform.OS === 'android') {
    try {
      const granted = await PermissionsAndroid.request(
        PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION,
        {
          title: 'å®šä½æƒé™',
          message: 'éœ€è¦è·å–æ‚¨çš„å®šä½æƒé™ä»¥æ˜¾ç¤ºåœ°å›¾ä½ç½®',
          buttonNeutral: 'ç¨åè¯¢é—®',
          buttonNegative: 'æ‹’ç»',
          buttonPositive: 'å…è®¸',
        },
      );
      if (granted === PermissionsAndroid.RESULTS.GRANTED) {
        console.log('å®šä½æƒé™å·²æˆæƒ');
      } else {
        console.log('å®šä½æƒé™è¢«æ‹’ç»');
      }
    } catch (err) {
      console.warn(err);
    }
  }
}
~~~

**ç”¨æ³•ï¼š**

~~~javascript
// éœ€è¦ç”¨å®šä½å‰è°ƒç”¨
await requestLocationPermission();
~~~

 **å¸¸ç”¨æƒé™**

- **ç›¸æœºæƒé™**ï¼šPermissionsAndroid.PERMISSIONS.CAMERA
- **è¯»å­˜å‚¨æƒé™**ï¼šPermissionsAndroid.PERMISSIONS.READ_EXTERNAL_STORAGE
- **å†™å­˜å‚¨æƒé™**ï¼šPermissionsAndroid.PERMISSIONS.WRITE_EXTERNAL_STORAGE

**ç”³è¯·æ–¹å¼åŒä¸Šï¼Œåªéœ€æŠŠ PERMISSIONS.XXXæ¢æˆå¯¹åº”æƒé™å³å¯ã€‚**

- 6.2 Platform æ¨¡å—ä¸å¹³å°å·®å¼‚å¤„ç†

**Platformæ¨¡å—ä½œç”¨**

Platform æ˜¯ React Native æä¾›çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºåˆ¤æ–­å½“å‰è¿è¡Œç¯å¢ƒæ˜¯ Android è¿˜æ˜¯ iOSï¼Œä»è€Œå®ç°å¹³å°å·®å¼‚åŒ–å¤„ç†ã€‚

**å¼•å…¥æ–¹å¼ï¼š**

~~~javascript
import { Platform } from 'react-native';
~~~

**å¸¸ç”¨åˆ¤æ–­ï¼š**

~~~javascript
if (Platform.OS === 'android') {
 
}

if (Platform.OS === 'ios') {
}
~~~

**å¹³å°å·®å¼‚åŒ–èµ‹å€¼**

**æ¯”å¦‚é«˜å¾·åœ°å›¾key,**Platform.select å¯ä»¥æ ¹æ®ä¸åŒå¹³å°è¿”å›ä¸åŒçš„å€¼ã€‚

~~~javascript
const amapKey = Platform.select({
 android: "ä½ çš„å®‰å“key",
 ios: "ä½ çš„iOS key",
});
~~~

##### 7. è°ƒè¯•ä¸æ€§èƒ½ä¼˜åŒ–

- 7.1 Metro è°ƒè¯•ä¸ç¼“å­˜æ¸…ç†
- 7.2 Chrome/Flipper è°ƒè¯•å·¥å…·
- 7.3 adb logcat/Android Studio Logcat åŸç”Ÿæ—¥å¿—åˆ†æ
- 7.4 æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼ˆåˆ—è¡¨ä¼˜åŒ–ã€å›¾ç‰‡ä¼˜åŒ–ç­‰ï¼‰

##### 8. é¡¹ç›®ç»“æ„ä¸å·¥ç¨‹ç®¡ç†

- 8.1 ç›®å½•ç»“æ„è®¾è®¡
- 8.2 å¤šç¯å¢ƒé…ç½®ï¼ˆdev/prodï¼‰
- 8.3 è„šæœ¬ä¸è‡ªåŠ¨åŒ–ï¼ˆå¦‚ fastlaneã€CI/CDï¼‰

##### 9. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

- 9.1 ä¾èµ–å†²çªä¸åŸç”Ÿå´©æºƒæ’æŸ¥
- 9.2 å¸¸è§æŠ¥é”™åŠå¤„ç†æ–¹æ³•
- 9.3 ç¤¾åŒºèµ„æºä¸æ–‡æ¡£æŸ¥æ‰¾æŠ€å·§



#### JSã€TS

##### æ€»ä½“ç†è§£

| é¡¹ç›®         | JavaScriptï¼ˆJSï¼‰       | TypeScriptï¼ˆTSï¼‰                      |
| ------------ | ---------------------- | ------------------------------------- |
| ç±»å‹ç³»ç»Ÿ     | åŠ¨æ€ç±»å‹ï¼ˆè¿è¡Œæ—¶æ£€æŸ¥ï¼‰ | é™æ€ç±»å‹ï¼ˆç¼–è¯‘æ—¶æ£€æŸ¥ï¼‰                |
| é”™è¯¯å‘ç°     | è¿è¡Œæ—¶æŠ¥é”™             | å†™ä»£ç æ—¶æŠ¥é”™ï¼ˆç±»å‹æ¨æ–­ + ç¼–è¾‘å™¨æç¤ºï¼‰ |
| ä»£ç æç¤º     | å‡ ä¹æ²¡æœ‰               | æ™ºèƒ½è¡¥å…¨ã€è·³è½¬ã€é‡æ„èƒ½åŠ›å¼º            |
| é¡¹ç›®å¯ç»´æŠ¤æ€§ | è¾ƒå·®ï¼Œæ˜“å‡ºé”™           | æ›´å¯é ï¼Œæ›´é€‚åˆå¤§å‹é¡¹ç›®                |

å¯¹æ¯”å·®å¼‚

| ç« èŠ‚å†…å®¹                      | JavaScript æ”¯æŒ | TypeScript æ”¯æŒ | è¯´æ˜                                   |
| ----------------------------- | --------------- | --------------- | -------------------------------------- |
| 5. è”åˆç±»å‹ï¼ˆ`string          | number`ï¼‰       | âŒ ä¸æ”¯æŒ        | âœ… æ”¯æŒ                                 |
| 5. ç±»å‹åˆ«åï¼ˆ`type X = ...`ï¼‰ | âŒ ä¸æ”¯æŒ        | âœ… æ”¯æŒ          | JS æ²¡æœ‰ç±»å‹ç³»ç»Ÿï¼ŒTS å¯å°è£…å¤æ‚ç±»å‹     |
| 6. ç±»å‹æ–­è¨€ï¼ˆ`as T`ï¼‰         | âŒ ä¸æ”¯æŒ        | âœ… æ”¯æŒ          | JS æ— æ³•æ–­è¨€ç±»å‹ï¼ŒTS å¯æ‰‹åŠ¨æŒ‡å®šç±»å‹     |
| 7. æ³›å‹ï¼ˆ`<T>`ï¼‰              | âŒ ä¸æ”¯æŒ        | âœ… æ”¯æŒ          | TS æ”¯æŒæ³›å‹ï¼ŒJS æ— æ³•åšåˆ°ç±»å‹é€šç”¨å¤ç”¨   |
| 8. ç±»çš„è®¿é—®ä¿®é¥°ç¬¦             | âŒï¼ˆES ææ¡ˆä¸­ï¼‰  | âœ… æ”¯æŒ          | TS å®Œæ•´æ”¯æŒ `private/protected` ç­‰ç‰¹æ€§ |
| 9. å·¥å…·ç±»å‹ï¼ˆ`Partial<T>`ï¼‰   | âŒ ä¸æ”¯æŒ        | âœ… æ”¯æŒ          | JS å®Œå…¨æ²¡æœ‰ï¼ŒTS å†…ç½®å·¥å…·å¯ç®€åŒ–å¼€å‘     |



##### 1.å˜é‡å£°æ˜ä¸æ³¨é‡Š

jsï¼š

~~~javascript
let name = 'Alice';
let age = 25;
~~~

Ts:

~~~typescript
let name: string = 'Alice';
let age: number = 25;
~~~

- ç±»å‹æ˜¾å¼ï¼š`name: string`

- ç±»å‹æ¨æ–­ï¼šå³ä½¿ä¸å†™ï¼ŒTS ä¹Ÿèƒ½è‡ªåŠ¨æ¨æ–­

~~~typescript
let isOnline = true; // æ¨æ–­ä¸º boolean
~~~

##### 2.å‡½æ•°ï¼šå‚æ•°ä¸è¿”å›å€¼ç±»å‹

jsï¼š

~~~javascript
function greet(name) {
  return 'Hello, ' + name;
}
~~~

ts:

~~~typescript
function greet(name: string): string {
  return 'Hello, ' + name;
}
~~~

å‚æ•°å’Œè¿”å›å€¼å¿…é¡»æ˜ç¡®ç±»å‹ï¼Œæ”¯æŒå¯é€‰å‚æ•°ã€é»˜è®¤å‚æ•°

~~~typescript
function sayHi(name?: string) {
  return `Hi, ${name ?? 'Guest'}`;
}
~~~

##### 3.å¯¹è±¡ä¸æ¥å£ï¼ˆinterfaceï¼‰

Js:

~~~javascript
const user = {
  name: 'Tom',
  age: 30,
};
~~~

Ts:(æ¨èå®šä¹‰æ¥å£)

~~~typescript
interface User {
  name: string;
  age: number;
}

const user: User = {
  name: 'Tom',
  age: 30,
};
~~~

- æ¥å£ interface ç”¨äºè§„èŒƒå¯¹è±¡ç»“æ„

- å¯é€‰å±æ€§ï¼š`age?: number`

- åªè¯»å±æ€§ï¼š`readonly id: string`

##### 4.æ•°ç»„ä¸å…ƒç»„

JS å†™æ³•ï¼š

```javascript
let nums = [1, 2, 3];
```

TS å†™æ³•ï¼š

```typescript
let nums: number[] = [1, 2, 3];
let names: Array<string> = ['a', 'b'];

// å…ƒç»„ï¼šå›ºå®šç±»å‹å’Œé•¿åº¦
let tuple: [string, number] = ['Tom', 20];
```

ç²¾ç¡®æ§åˆ¶æ¯ä¸ªå…ƒç´ çš„ç±»å‹ï¼Œå…ƒç»„å¸¸ç”¨äºè¿”å›å¤šå€¼

##### 5.è”åˆç±»å‹ä¸ç±»å‹åˆ«å

t s:

~~~typescript
let id: string | number; // å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—

type Status = 'success' | 'error' | 'loading';

let state: Status = 'success';
~~~

- **è”åˆç±»å‹**ï¼ˆå¤šä¸ªç±»å‹ï¼‰ï¼šçµæ´»åº”å¯¹å‚æ•°å¤šæ ·æ€§

- **ç±»å‹åˆ«å**ï¼šç®€åŒ–å¤æ‚ç±»å‹å®šä¹‰

##### 6.ç±»å‹æ–­è¨€ï¼ˆType Assertionï¼‰

t s:

~~~typescript
let value: any = 'hello';
let len = (value as string).length;
~~~

æˆ–ï¼š

~~~typescript
let len = (<string>value).length;
~~~

è·³è¿‡æ¨æ–­ï¼Œå¸¸ç”¨äºç±»å‹ä¸æ˜ç¡®ã€ä½†ä½ æ¸…æ¥šæƒ…å†µæ—¶

##### 7.æ³›å‹ï¼ˆGenericï¼‰

Ts:(ç±»ä¼¼äºc++çš„æ¨¡æ¿)

~~~typescript
function echo<T>(arg: T): T {
  return arg;
}

echo<number>(123);
echo<string>('hello');
~~~

æ³›å‹è®©å‡½æ•°ã€æ¥å£æ”¯æŒå¤šç§ç±»å‹ï¼Œä¿æŒç±»å‹ä¸€è‡´æ€§ï¼Œæé«˜å¤ç”¨æ€§

##### 8.ç±»ä¸è®¿é—®ä¿®é¥°ç¬¦

Ts:

~~~typescript
class Person {
  public name: string;
  private age: number;

  constructor(name: string, age: number) {
    this.name = name;
    this.age = age;
  }

  greet() {
    return `Hi, I'm ${this.name}`;
  }
}
~~~

- `public`ï¼šé»˜è®¤ï¼Œå¤–éƒ¨å¯è®¿é—®

- `private`ï¼šä»…é™ç±»å†…è®¿é—®

- `protected`ï¼šç±»åŠå…¶å­ç±»å¯è®¿é—®

- æ”¯æŒæŠ½è±¡ç±»ã€æ¥å£å®ç°ç­‰é¢å‘å¯¹è±¡ç‰¹æ€§

##### Utility Types

| å·¥å…·ç±»å‹      | å«ä¹‰                    |
| ------------- | ----------------------- |
| `Partial<T>`  | å°† T çš„æ‰€æœ‰å±æ€§è®¾ä¸ºå¯é€‰ |
| `Required<T>` | å°† T çš„æ‰€æœ‰å±æ€§è®¾ä¸ºå¿…å¡« |
| `Pick<T, K>`  | å– T çš„æŸäº›å±æ€§         |
| `Omit<T, K>`  | æ’é™¤ T çš„æŸäº›å±æ€§       |
| `Readonly<T>` | æ‰€æœ‰å±æ€§å˜ä¸ºåªè¯»        |

Ts:

~~~typescript
interface User {
  id: number;
  name: string;
  email: string;
}

type UserPreview = Pick<User, 'id' | 'name'>;
type OptionalUser = Partial<User>;
~~~



#### Charlesçš„ä½¿ç”¨



#### sourceTreeçš„ä½¿ç”¨



#### å­¦ä¹ å¿ƒå¾—ï¼š

è¿™ä¸ªæœˆå¯¹äºRNçš„å­¦ä¹ ï¼Œä»å•ä¸ªç»„ä»¶åˆ°ç®€å•åŠŸèƒ½ç»„åˆï¼Œè¯•ç€å•ƒäº†ä¸å°‘å°æ¨¡å—ï¼Œè¿‡ç¨‹ç¨å¾®æœ‰äº›ç£•ç»Šï¼Œè®°å‡ ç‚¹å…·ä½“çš„æ„Ÿå—ï¼š

ä¸€ã€Hook

â€‹	åˆšå¼€å§‹ç”¨ useState å’Œ useEffect ï¼Œçº¯å±è·Ÿç€ä¾‹å­å†™â€”â€”è®¡æ•°å™¨ç”¨ useState å­˜æ•°å­—ï¼Œè¯·æ±‚æ•°æ®åœ¨ useEffect é‡Œå†™ã€‚åšonboardingé¡µé¢æ—¶ï¼Œéœ€è¦è®°å½•â€œæ˜¯å¦é¦–æ¬¡æ‰“å¼€â€ï¼Œç”¨ useState å­˜çŠ¶æ€ï¼Œé…åˆ useEffect è¯»å– AsyncStorage é‡Œçš„æ ‡è®°ï¼Œæ…¢æ…¢æ˜ç™½ï¼š useState æ˜¯æš‚å­˜å½“å‰é¡µé¢çš„æ•°æ®ï¼Œ useEffect æ˜¯å¤„ç†é¡µé¢åŠ è½½/æ•°æ®å˜åŒ–æ—¶çš„æ“ä½œã€‚

â€‹	ç”¨Vueæ—¶ä¹ æƒ¯äº† v-if æ§åˆ¶æ˜¾ç¤ºã€ v-for å¾ªç¯åˆ—è¡¨ï¼Œåˆ°RNé‡Œå‘ç°é€»è¾‘æ²¡å˜ï¼Œå†™æ³•å´æ¢äº†ï¼šæ¡ä»¶æ¸²æŸ“ç”¨ `{isShow && <View />}` ï¼Œåˆ—è¡¨æ¸²æŸ“é  `FlatList` ï¼Œè™½ç„¶ä¸€å¼€å§‹è§‰å¾—ä¸å¦‚æŒ‡ä»¤ç›´è§‚ï¼Œä½†å†™å¤šäº†å‘ç°ï¼Œè¿™ç§â€œJSé€»è¾‘ç›´æ¥åµŒå…¥UIâ€çš„æ–¹å¼å…¶å®æ›´çµæ´»â€”â€”æ¯”å¦‚ç»™ FlatList çš„ renderItem åŠ æ¡ä»¶åˆ¤æ–­ï¼Œæ ¹æ®itemç±»å‹æ¸²æŸ“ä¸åŒç»„ä»¶ï¼Œæ¯”Vueé‡Œåœ¨ v-for é‡ŒåµŒå¥— v-if æ€è·¯æ›´æ¸…æ™°ã€‚

â€‹	åœ¨RNé‡Œå¤„ç†çŠ¶æ€å’Œå‰¯ä½œç”¨ï¼Œç¡®å®å’ŒVueçš„æ€è·¯æœ‰å¾®å¦™å·®åˆ«ï¼Œä½†ç”¨ç†Ÿäº†ä¼šè§‰å¾—æ›´ç›´æ¥â€”â€”å°¤å…¶æ˜¯çŠ¶æ€ç®¡ç†å’Œå‰¯ä½œç”¨çš„ç»‘å®šï¼Œé€»è¾‘é“¾æ¡å¾ˆæ¸…æ™°ã€‚

â€‹	å°±æ‹¿åšToastç»„ä»¶æ¥è¯´ï¼Œç”¨ useState ç®¡ç†æ˜¾ç¤ºçŠ¶æ€ï¼ˆ visible ï¼‰å’Œæ–‡æœ¬ï¼ˆ message ï¼‰ï¼Œå†ç”¨ useEffect ç›‘å¬ visible çš„å˜åŒ–ï¼šå½“ visible ä» false å˜æˆ true æ—¶ï¼Œå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå‡ ç§’åè‡ªåŠ¨æŠŠ visible åˆ‡å› false ã€‚æ•´ä¸ªé€»è¾‘å†™ä¸‹æ¥å°±æ˜¯ï¼š

~~~javascript
const [visible, setVisible] = useState(false);
const [message, setMessage] = useState('');

useEffect(() => {
  if (visible) {
    const timer = setTimeout(() => setVisible(false), 2000);
    return () => clearTimeout(timer); // ç»„ä»¶å¸è½½æ—¶æ¸…å®šæ—¶å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼
  }
}, [visible]); // åªåœ¨visibleå˜åŒ–æ—¶è§¦å‘ï¼Œç²¾å‡†æ§åˆ¶æ‰§è¡Œæ—¶æœº
~~~


â€‹	è¿™ç§å†™æ³•çš„å¥½å¤„æ˜¯ï¼Œå‰¯ä½œç”¨ï¼ˆå®šæ—¶å™¨ï¼‰å’Œä¾èµ–ï¼ˆvisibleï¼‰ç›´æ¥ç»‘å®šï¼Œä¸åƒVueé‡Œéœ€è¦åœ¨ mounted é‡Œå†™å¯åŠ¨é€»è¾‘ï¼Œå†åœ¨ watch é‡Œå¤„ç†å˜åŒ–â€”â€”RNé‡Œç”¨ä¸€ä¸ª useEffect å°±æŠŠâ€œæ˜¾ç¤ºæ—¶å¯åŠ¨å®šæ—¶å™¨ã€éšè—æ—¶æ¸…é™¤ã€ä¾èµ–å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œâ€å…¨æå®šäº†ï¼Œé€»è¾‘æ”¶æ‹¢åœ¨ä¸€å—ï¼Œæ‰¾é—®é¢˜æ—¶ä¹Ÿæ›´å®¹æ˜“å®šä½ã€‚

â€‹	è€Œä¸” const [count, setCount] è¿™ç§å£°æ˜å¼å®šä¹‰ï¼ŒçŠ¶æ€å’Œä¿®æ”¹å‡½æ•°æˆå¯¹å‡ºç°ï¼Œç”¨çš„æ—¶å€™ä¸ç”¨æƒ³ this æŒ‡å‘ï¼Œç›´æ¥è°ƒç”¨ setCount å°±è¡Œï¼Œæ¯”å¦‚Toastçš„æ˜¾ç¤ºæ–¹æ³•ï¼š

~~~java
const showToast = (text) => {
  setMessage(text);
  setVisible(true);
};
~~~


â€‹	è°ƒç”¨æ—¶ç›´æ¥ showToast('æ“ä½œæˆåŠŸ') ï¼Œæ¯”Vueé‡Œ this.message = text; this.visible = true å°‘äº† this çš„å¹²æ‰°ï¼Œå†™èµ·æ¥æ›´æ¸…çˆ½ã€‚åˆšå¼€å§‹ç¡®å®ä¼šæ€€å¿µVueçš„â€œå“åº”å¼è‡ªåŠ¨æ›´æ–°â€ï¼Œä½†RNè¿™ç§â€œæ‰‹åŠ¨å£°æ˜çŠ¶æ€+æ˜¾å¼è§¦å‘æ›´æ–°â€çš„æ–¹å¼ï¼Œè™½ç„¶å¤šå†™å‡ è¡Œï¼Œå´èƒ½è®©çŠ¶æ€æµè½¬çš„æ¯ä¸€æ­¥éƒ½æ›´å¯æ§ï¼Œå°¤å…¶åœ¨å¤„ç†å¤æ‚äº¤äº’æ—¶ï¼Œä¸å®¹æ˜“å‡ºç°â€œä¸çŸ¥é“å“ªé‡Œæ”¹äº†çŠ¶æ€â€çš„æƒ…å†µã€‚

äºŒã€ç¬¬ä¸‰æ–¹APIï¼š

â€‹	è°·æ­Œç™»å½•çœ‹ç€ç®€å•ï¼Œå®é™…è¦æ³¨æ„çš„ç»†èŠ‚ä¸å°‘ï¼š GoogleSignin.configure é‡Œçš„ scopes å¾—æŒ‰éœ€æ±‚å¡«ï¼Œä¸ç„¶æ‹¿ä¸åˆ°ç”¨æˆ·é‚®ç®±ï¼›ç™»å½•æˆåŠŸåï¼Œ user å¯¹è±¡é‡Œçš„ idToken å’Œ accessToken è¦åŒºåˆ†å¼€ï¼Œè°ƒåç«¯æ¥å£æ—¶åˆ«ä¼ é”™ã€‚ç¬¬ä¸€æ¬¡é›†æˆæ—¶ï¼Œå°±å› ä¸ºæ²¡å¤„ç†â€œç”¨æˆ·å–æ¶ˆç™»å½•â€çš„å›è°ƒï¼Œå¯¼è‡´é¡µé¢å¡æ­»ï¼Œåæ¥æ‰çŸ¥é“ signIn è¿”å›çš„ promise è¦åŠ  catch æ•è·é”™è¯¯ã€‚

â€‹	é«˜å¾·åœ°å›¾æ›´è€ƒéªŒè€å¿ƒï¼šå®‰è£…äº†å‡ ä¸ªrnçš„ç¬¬ä¸‰æ–¹åº“ä¾èµ–åå‘ç°ä¼šå‘ç”Ÿå†²çªï¼Œä½†æ˜¯æ— æ³•åªä¾èµ–å…¶ä¸­ä¸€ä¸ªåº“å°±å®ç°æ˜¾ç¤ºåœ°å›¾å’Œè·å–é€†åœ°ç†ç¼–ç ï¼Œæ‰€ä»¥è¿™ç±»åŠŸèƒ½æ¨¡å—ä¸€èˆ¬ä½¿ç”¨åŸç”Ÿé›†æˆå†ä¸RNæ¡¥æ¥çš„åŠæ³•ã€‚ç»™åœ°å›¾åŠ å¼¹çª—æ—¶ï¼Œç”¨ Modal ç»„ä»¶åŒ…è£¹å†…å®¹ï¼Œå†é€šè¿‡ onPress äº‹ä»¶æ§åˆ¶ visible çŠ¶æ€ï¼Œè™½ç„¶æ˜¯åŸºç¡€ç»„ä»¶ç»„åˆï¼Œä½†å’Œåœ°å›¾è”åŠ¨èµ·æ¥ï¼Œæœ‰ç§â€œåŠŸèƒ½æ´»äº†â€çš„æ„Ÿè§‰ã€‚Vueé‡Œç”¨åœ°å›¾ç»„ä»¶åªéœ€å¼•JSåº“ï¼ŒRNé‡Œå´è¦å¤„ç† MapView çš„åŸç”Ÿæ¸²æŸ“ï¼Œæ¯”å¦‚ç»™åœ°å›¾åŠ æ ‡è®°ç‚¹ï¼ŒVueæ˜¯è°ƒç”¨APIæ–¹æ³•ï¼ŒRNé‡Œåˆ™æ˜¯åœ¨ MapView é‡ŒåµŒå¥— Marker ç»„ä»¶ï¼Œè¿™ç§â€œç»„ä»¶åŒ–åµŒå¥—â€çš„æ€è·¯åè€Œå’ŒVueçš„ç»„ä»¶å¤ç”¨ç†å¿µæ›´åƒï¼Œä¸Šæ‰‹æ¯”æƒ³è±¡ä¸­å¿«ã€‚

ä¸‰ã€å¤ç”¨ä¸äº¤äº’

â€‹	å†™åŠ è½½å™¨ï¼ˆLoaderï¼‰å’ŒToastï¼Œè¯•ç€å°è£…æˆè‡ªå®šä¹‰ç»„ä»¶ï¼šLoaderæ¥æ”¶ visible å‚æ•°æ§åˆ¶æ˜¾ç¤ºéšè—ï¼ŒToastä¼  message å’Œ duration ï¼Œç”¨ useEffect æ§åˆ¶è‡ªåŠ¨æ¶ˆå¤±ã€‚åœ¨é¡µé¢é‡Œç”¨ `<Loader visible={loading} /> `,åŒæ—¶å¤ç”¨çš„è¿˜æœ‰å›¾ç‰‡å¼¹çª—ï¼Œè¿˜æœ‰è¡¨å•æŒ‰é’®ä¹‹ç±»çš„ã€‚

â€‹	RNé‡Œç”¨ Animated åº“åšåŠ¨ç”»ï¼Œåˆšå¼€å§‹è§‰å¾—APIå¤ªç¹çï¼Œå®šä¹‰ Animated.Value ã€å†™ scroll åŠ¨ç”»ã€ç»‘å®šåˆ°ç»„ä»¶æ ·å¼ï¼Œä¸è¿‡é€šè¿‡çŠ¶æ€é©±åŠ¨æ ·å¼å˜åŒ–ï¼Œæ‹†è§£é€»è¾‘é€æ­¥å®ç°å³å¯ã€‚

å››ã€æœ€å¤§çš„æ”¶è·ï¼šç†æ¸…ä»£ç ä¹¦å†™æ€è·¯

åšç™»å½•ã€åœ°å›¾ã€ä¾§è¾¹æ çš„é¡µé¢ç­‰éœ€æ±‚ï¼Œä¸‹æ„è¯†æ‹†æˆå°æ­¥éª¤ï¼šå…ˆæ­é¡µé¢ç»“æ„ï¼ˆç”¨ View å’Œ Flex å¸ƒå±€ï¼‰ï¼Œå†åŠ çŠ¶æ€ç®¡ç†ï¼ˆ useState å­˜ç™»å½•çŠ¶æ€ã€åœ°å›¾åæ ‡ï¼‰ï¼Œç„¶åé›†æˆç¬¬ä¸‰æ–¹APIï¼ˆè°·æ­Œç™»å½•ã€é«˜å¾·åœ°å›¾ï¼‰ï¼Œæœ€åè¡¥äº¤äº’ï¼ˆä¾§è¾¹æ å±•å¼€/æ”¶èµ·ã€Toastæç¤ºï¼‰ã€‚

æœ‰æ—¶ä¼šçŠ¯ä½çº§é”™è¯¯ï¼ˆæ¯”å¦‚ AsyncStorage å¿˜äº† JSON.stringify æ•°æ®ï¼Œå¯¼è‡´è¯»å–æ—¶å‡ºé”™ï¼‰ã€‚å¯¹äºçŠ¶æ€ç®¡ç†Redux ç­‰è¿˜ä¸æ˜¯å¾ˆç†Ÿç»ƒï¼Œä½†æ˜¯é¡µé¢å¤šäº†ä¹‹åï¼Œç”¨ useState ä¼ å‚æœ‰ç‚¹ç»•ï¼Œå¸Œæœ›èƒ½æŠŠç»„ä»¶é—´çš„æ•°æ®æµè½¬ç†å¾—æ›´é¡ºä¸€ç‚¹ã€‚



## ç¬¬äºŒä¸ªæœˆï¼š 

### 1ã€ç†Ÿæ‚‰Androidé¡¹ç›®ã€é¡¹ç›®ç»“æ„ã€é¡¹ç›®é…ç½®ï¼ŒæŒæ¡kotlinè¯­è¨€åŸºç¡€åŠè¯­æ³• 

### 2ã€ç†Ÿæ‚‰å®‰å“ä»£ç è§„èŒƒã€RNä»£ç è§„èŒƒï¼Œå¯è¿›è¡Œç®€å•çš„é¡¹ç›®ä»£ç é˜…è¯»åŠç†è§£ 

### 3ã€æ•´ç†å­¦ä¹ ç¬”è®°å¹¶æ€»ç»“å¿ƒå¾—ä½“ä¼š 



#### kotlinè¯­æ³•åŸºç¡€

[kotlinæ•™ç¨‹](https://www.runoob.com/kotlin/kotlin-basic-syntax.html)

åŸºç¡€è¯­æ³•ï¼š

å‡½æ•°è¿”å›å€¼ï¼š

~~~kotlin
public fun sum(a: Int, b: Int): Int = a + b   // public æ–¹æ³•åˆ™å¿…é¡»æ˜ç¡®å†™å‡ºè¿”å›ç±»å‹

// å¦‚æœæ˜¯è¿”å› Unitç±»å‹ï¼Œåˆ™å¯ä»¥çœç•¥(å¯¹äºpublicæ–¹æ³•ä¹Ÿæ˜¯è¿™æ ·)ï¼š
public fun printSum(a: Int, b: Int) { 
    print(a + b)
}
~~~

å¯å˜é•¿å‚æ•°å‡½æ•°ï¼šç”¨ **vararg** å…³é”®å­—è¿›è¡Œæ ‡è¯†

~~~kotlin
fun vars(vararg v:Int){
    for(vt in v){
        print(vt)
    }
}

// æµ‹è¯•
fun main(args: Array<String>) {
    vars(1,2,3,4,5)  // è¾“å‡º12345
}
~~~

NULLæ£€æŸ¥æœºåˆ¶:å¯¹äºå£°æ˜å¯ä¸ºç©ºçš„å‚æ•°ï¼Œåœ¨ä½¿ç”¨æ—¶è¦è¿›è¡Œç©ºåˆ¤æ–­å¤„ç†ï¼Œæœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼Œå­—æ®µååŠ !!åƒJavaä¸€æ ·æŠ›å‡ºç©ºå¼‚å¸¸ï¼Œå¦ä¸€ç§å­—æ®µååŠ ?å¯ä¸åšå¤„ç†è¿”å›å€¼ä¸º **null** æˆ–é…åˆ **?:** åšç©ºåˆ¤æ–­å¤„ç†

~~~kotlin
//ç±»å‹åé¢åŠ ?è¡¨ç¤ºå¯ä¸ºç©º
var age: String? = "23" 
//æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸
val ages = age!!.toInt()
//ä¸åšå¤„ç†è¿”å› null
val ages1 = age?.toInt()
//ageä¸ºç©ºè¿”å›-1
val ages2 = age?.toInt() ?: -1

~~~

ç±»å‹æ£€æµ‹åŠè‡ªåŠ¨ç±»å‹è½¬æ¢:å¯ä»¥ä½¿ç”¨ **is** è¿ç®—ç¬¦æ£€æµ‹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯æŒ‡å®šç±»å‹çš„å®ä¾‹(ç±»ä¼¼äº Java ä¸­çš„ instanceof å…³é”®å­—)ã€‚

~~~kotlin
fun getStringLength(obj: Any): Int? {
  if (obj is String) {
    // åšè¿‡ç±»å‹åˆ¤æ–­ä»¥åï¼Œobjä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨è½¬æ¢ä¸ºStringç±»å‹
    return obj.length 
  }
}
~~~

åŒºé—´ï¼š

~~~kotlin
for (i in 1..4) print(i) // è¾“å‡ºâ€œ1234â€

for (i in 4..1) print(i) // ä»€ä¹ˆéƒ½ä¸è¾“å‡º

if (i in 1..10) { // ç­‰åŒäº 1 <= i && i <= 10
    println(i)
}

// ä½¿ç”¨ step æŒ‡å®šæ­¥é•¿
for (i in 1..4 step 2) print(i) // è¾“å‡ºâ€œ13â€

for (i in 4 downTo 1 step 2) print(i) // è¾“å‡ºâ€œ42â€


// ä½¿ç”¨ until å‡½æ•°æ’é™¤ç»“æŸå…ƒç´ 
for (i in 1 until 10) {   // i in [1, 10) æ’é™¤äº† 10
     println(i)
}
~~~

Valï¼šä¸å¯å˜å˜é‡ï¼Œå£°æ˜æ—¶å¦‚æœä¸åˆå§‹åŒ–ï¼Œéœ€è¦å®šä¹‰ç±»å‹

varï¼šå¯å˜å˜é‡

Lambda 

~~~kotlin
val sumLambda: (Int, Int) -> Int = {x,y -> x+y}
println(sumLambda(1,2))  // è¾“å‡º 3
~~~

å­—ç¬¦ä¸²æ¨¡æ¿:

~~~kotlin
$ è¡¨ç¤ºä¸€ä¸ªå˜é‡åæˆ–è€…å˜é‡å€¼
$varName è¡¨ç¤ºå˜é‡å€¼
${varName.fun()} è¡¨ç¤ºå˜é‡çš„æ–¹æ³•è¿”å›å€¼:
~~~

String å¯ä»¥é€šè¿‡ trimMargin() æ–¹æ³•æ¥åˆ é™¤å¤šä½™çš„ç©ºç™½ã€‚

~~~kotlin
fun main(args: Array<String>) {
    val text = """
    |å¤šè¡Œå­—ç¬¦ä¸²
    |èœé¸Ÿæ•™ç¨‹
    |å¤šè¡Œå­—ç¬¦ä¸²
    |Runoob
    """.trimMargin()
    println(text)    // å‰ç½®ç©ºæ ¼åˆ é™¤äº†
}
~~~

åŸç”Ÿå­—ç¬¦ä¸²å’Œè½¬ä¹‰å­—ç¬¦ä¸²å†…éƒ¨éƒ½æ”¯æŒæ¨¡æ¿ã€‚ å¦‚æœä½ éœ€è¦åœ¨åŸç”Ÿå­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå­—é¢å€¼ $ å­—ç¬¦ï¼ˆå®ƒä¸æ”¯æŒåæ–œæ è½¬ä¹‰ï¼‰ï¼Œä½ å¯ä»¥ç”¨ä¸‹åˆ—è¯­æ³•ï¼š

~~~kotlin
fun main(args: Array<String>) {
    val price = """
    ${'$'}9.99
    """
    println(price)  // æ±‚å€¼ç»“æœä¸º $9.99
}
~~~

æŠ½è±¡ç±»

~~~kotlin
open class Animal {
    open fun speak() {
        println("Some sound")
    }
}

abstract class Dog : Animal() {
    override abstract fun speak()
}

class Bulldog : Dog() {
    override fun speak() {
        println("Woof!")
    }
}
~~~

å†…éƒ¨ç±»

~~~kotlin
class Outer {
    private val bar: Int = 1
    var v = "æˆå‘˜å±æ€§"
    /**åµŒå¥—å†…éƒ¨ç±»**/
    inner class Inner {
        fun foo() = bar  // è®¿é—®å¤–éƒ¨ç±»æˆå‘˜
        fun innerTest() {
            var o = this@Outer //è·å–å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡
            println("å†…éƒ¨ç±»å¯ä»¥å¼•ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜ï¼Œä¾‹å¦‚ï¼š" + o.v)
        }
    }
}

fun main(args: Array<String>) {
    val demo = Outer().Inner().foo()
    println(demo) //   1
    val demo2 = Outer().Inner().innerTest()   
    println(demo2)   // å†…éƒ¨ç±»å¯ä»¥å¼•ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜ï¼Œä¾‹å¦‚ï¼šæˆå‘˜å±æ€§
}
~~~

åŒ¿åå†…éƒ¨ç±»ï¼š

~~~kotlin
class Test {
    var v = "æˆå‘˜å±æ€§"

    fun setInterFace(test: TestInterFace) {
        test.test()
    }
}

/**
 * å®šä¹‰æ¥å£
 */
interface TestInterFace {
    fun test()
}

fun main(args: Array<String>) {
    var test = Test()

    /**
     * é‡‡ç”¨å¯¹è±¡è¡¨è¾¾å¼æ¥åˆ›å»ºæ¥å£å¯¹è±¡ï¼Œå³åŒ¿åå†…éƒ¨ç±»çš„å®ä¾‹ã€‚
     */
    test.setInterFace(object : TestInterFace {
        override fun test() {
            println("å¯¹è±¡è¡¨è¾¾å¼åˆ›å»ºåŒ¿åå†…éƒ¨ç±»çš„å®ä¾‹")
        }
    })
}
~~~

ä½¿ç”¨ï¼šæ¯”å¦‚ç‚¹å‡»äº‹ä»¶å›æ‰

~~~kotlin
button.setOnClickListener(object : View.OnClickListener {
    override fun onClick(v: View?) {
        println("ç‚¹å‡»äº‹ä»¶")
    }
})
~~~

ç±»çš„ä¿®é¥°ç¬¦åŒ…æ‹¬ classModifier å’Œ_accessModifier_:

- classModifier: ç±»å±æ€§ä¿®é¥°ç¬¦ï¼Œæ ‡ç¤ºç±»æœ¬èº«ç‰¹æ€§ã€‚

  ```
  abstract    // æŠ½è±¡ç±»  
  final       // ç±»ä¸å¯ç»§æ‰¿ï¼Œé»˜è®¤å±æ€§
  enum        // æšä¸¾ç±»
  open        // ç±»å¯ç»§æ‰¿ï¼Œç±»é»˜è®¤æ˜¯finalçš„
  annotation  // æ³¨è§£ç±»
  ```

- accessModifier: è®¿é—®æƒé™ä¿®é¥°ç¬¦

  ```
  private    // ä»…åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­å¯è§
  protected  // åŒä¸€ä¸ªæ–‡ä»¶ä¸­æˆ–å­ç±»å¯è§
  public     // æ‰€æœ‰è°ƒç”¨çš„åœ°æ–¹éƒ½å¯è§
  internal   // åŒä¸€ä¸ªæ¨¡å—ä¸­å¯è§
  ```

ğŸ”§ Android ä¸­å¸¸è§æ³¨è§£ç¤ºä¾‹ annotation 

| æ³¨è§£                             | ä½œç”¨                          |
| -------------------------------- | ----------------------------- |
| `@Override`                      | è¡¨ç¤ºæ–¹æ³•æ˜¯é‡å†™çˆ¶ç±»/æ¥å£çš„æ–¹æ³• |
| `@Inject`                        | ç”¨äºä¾èµ–æ³¨å…¥                  |
| `@SerializedName("json_key")`    | Gson åºåˆ—åŒ–å­—æ®µæ˜ å°„           |
| `@NonNull` / `@Nullable`         | æç¤ºæŸå­—æ®µæ˜¯å¦å…è®¸ä¸º null     |
| `@GET("/api")` / `@POST("/api")` | Retrofit ç½‘ç»œè¯·æ±‚æ³¨è§£         |
| `@BindView(R.id.xxx)`            | ButterKnife ç»‘å®šæ§ä»¶          |

 ç¤ºä¾‹ä¸€ï¼šè‡ªå®šä¹‰æ³¨è§£ + åå°„è¯»å–

âœ… 1. å®šä¹‰ä¸€ä¸ªæ³¨è§£ç±»

```kotlin
@Target(AnnotationTarget.CLASS) // è¿™ä¸ªæ³¨è§£åªèƒ½ç”¨äºç±»ä¸Š
@Retention(AnnotationRetention.RUNTIME) // æ³¨è§£ä¿ç•™åˆ°è¿è¡Œæ—¶ï¼Œå¯ä»¥åå°„è·å–
annotation class Info(val author: String, val version: Int)
```

âœ… 2. ä½¿ç”¨æ³¨è§£

```kotlin
@Info(author = "å¼ ä¸‰", version = 1)
class MyService
```

âœ… 3. é€šè¿‡åå°„è¯»å–æ³¨è§£ä¿¡æ¯

```kotlin
fun main() {
    val clazz = MyService::class
    val annotation = clazz.annotations.find { it is Info } as? Info
    if (annotation != null) {
        println("ä½œè€…ï¼š${annotation.author}, ç‰ˆæœ¬ï¼š${annotation.version}")
    }
}
```

**è¾“å‡ºï¼š**

```
ä½œè€…ï¼šå¼ ä¸‰, ç‰ˆæœ¬ï¼š1
```

ğŸ“± ç¤ºä¾‹äºŒï¼šAndroid ä¸­çš„å¸¸è§æ³¨è§£ï¼ˆRetrofitï¼‰

âœ… å®šä¹‰æ¥å£ + ä½¿ç”¨æ³¨è§£

```kotlin
interface ApiService {
    @GET("user/info")
    fun getUserInfo(): Call<User>

    @POST("user/update")
    fun updateUser(@Body user: User): Call<Response>
}
```

è¿™äº› `@GET`ã€`@POST`ã€`@Body` å…¶å®éƒ½æ˜¯æ³¨è§£ç±»ï¼Œç”¨æ¥å‘Šè¯‰ **Retrofit æ¡†æ¶** è¯¥æ–¹æ³•å’Œå‚æ•°çš„æ„ä¹‰ã€‚

Retrofit å†…éƒ¨ä¼šé€šè¿‡åå°„æ‰«æè¿™äº›æ³¨è§£å¹¶ç”Ÿæˆç½‘ç»œè¯·æ±‚ã€‚

ğŸ§° ç¤ºä¾‹ä¸‰ï¼šGson æ³¨è§£ï¼ˆæ•°æ®è§£æï¼‰

âœ… ä½¿ç”¨æ³¨è§£ç±»æ˜ å°„ JSON å­—æ®µ

```kotlin
data class User(
    @SerializedName("user_name") val name: String,
    @SerializedName("user_age") val age: Int
)
```

JSONï¼š

```json
{
  "user_name": "æé›·",
  "user_age": 30
}
```

`@SerializedName("xxx")` æ˜¯ Gson æ¡†æ¶å®šä¹‰çš„æ³¨è§£ç±»ï¼Œç”¨æ¥å‘Šè¯‰å®ƒâ€œJSON çš„å­—æ®µåâ€å’Œ Kotlin å­—æ®µçš„æ˜ å°„å…³ç³»ã€‚

ğŸ”„ ç¤ºä¾‹å››ï¼šButterKnife æ³¨è§£ï¼ˆç»‘å®šæ§ä»¶ï¼‰

```java
@BindView(R.id.tv_title)
TextView title;

@OnClick(R.id.btn_submit)
public void onSubmitClick() {
    // å¤„ç†ç‚¹å‡»äº‹ä»¶
}
```

ButterKnife åº“é€šè¿‡æ³¨è§£è‡ªåŠ¨å¸®ä½ ç»‘å®šæ§ä»¶ï¼Œä¸ç”¨ `findViewById()`ï¼Œæé«˜æ•ˆç‡ã€‚

âœ… æ€»ç»“ä¸€ä¸‹

| æ³¨è§£ç”¨é€”   | ç¤ºä¾‹                     | æ³¨è§£ç±»                        |
| ---------- | ------------------------ | ----------------------------- |
| å®šä¹‰å…ƒæ•°æ® | `@Info(...)`             | è‡ªå®šä¹‰                        |
| ç½‘ç»œè¯·æ±‚   | `@GET`, `@POST`, `@Body` | Retrofit                      |
| JSONæ˜ å°„   | `@SerializedName`        | Gson                          |
| UIç»‘å®š     | `@BindView`, `@OnClick`  | ButterKnife                   |
| ç©ºå€¼æ§åˆ¶   | `@NonNull`, `@Nullable`  | JetBrains/Support annotations |

------

ä¸»ç±»æ²¡æœ‰ä¸»æ„é€ å‡½æ•°ï¼Œæ¬¡æ„é€ å‡½æ•°ä½¿ç”¨superå…³é”®å­—åˆå§‹åŒ–åŸºç±»

~~~kotlin
/**ç”¨æˆ·åŸºç±»**/
open class Person(name:String){
    /**æ¬¡çº§æ„é€ å‡½æ•°**/
    constructor(name:String,age:Int):this(name){
        //åˆå§‹åŒ–
        println("-------åŸºç±»æ¬¡çº§æ„é€ å‡½æ•°---------")
    }
}

/**å­ç±»ç»§æ‰¿ Person ç±»**/
class Student:Person{

    /**æ¬¡çº§æ„é€ å‡½æ•°**/
    constructor(name:String,age:Int,no:String,score:Int):super(name,age){
        println("-------ç»§æ‰¿ç±»æ¬¡çº§æ„é€ å‡½æ•°---------")
        println("å­¦ç”Ÿåï¼š ${name}")
        println("å¹´é¾„ï¼š ${age}")
        println("å­¦ç”Ÿå·ï¼š ${no}")
        println("æˆç»©ï¼š ${score}")
    }
}

fun main(args: Array<String>) {
    var s =  Student("Runoob", 18, "S12345", 89)
}
~~~

å¦‚æœæœ‰å¤šä¸ªç›¸åŒçš„æ–¹æ³•ï¼ˆç»§æ‰¿æˆ–è€…å®ç°è‡ªå…¶ä»–ç±»ï¼Œå¦‚Aã€Bç±»ï¼‰ï¼Œåˆ™å¿…é¡»è¦é‡å†™è¯¥æ–¹æ³•ï¼Œä½¿ç”¨ super æ³›å‹å»é€‰æ‹©æ€§åœ°è°ƒç”¨çˆ¶ç±»çš„å®ç°ã€‚

```kotlin
open class A {
    open fun f () { print("A") }
    fun a() { print("a") }
}

interface B {
    fun f() { print("B") } //æ¥å£çš„æˆå‘˜å˜é‡é»˜è®¤æ˜¯ open çš„
    fun b() { print("b") }
}

class C() : A() , B{
    override fun f() {
        super<A>.f()//è°ƒç”¨ A.f()
        super<B>.f()//è°ƒç”¨ B.f()
    }
}

fun main(args: Array<String>) {
    val c =  C()
    c.f();

}
```

æ¥å£ä¸­çš„å±æ€§:æ¥å£ä¸­çš„å±æ€§åªèƒ½æ˜¯æŠ½è±¡çš„ï¼Œä¸å…è®¸åˆå§‹åŒ–å€¼ï¼Œæ¥å£ä¸ä¼šä¿å­˜å±æ€§å€¼ï¼Œå®ç°æ¥å£æ—¶ï¼Œå¿…é¡»é‡å†™å±æ€§ï¼š

~~~kotlin
interface MyInterface{
    var name:String //name å±æ€§, æŠ½è±¡çš„
}
 
class MyImpl:MyInterface{
    override var name: String = "runoob" //é‡å†™å±æ€§
}
~~~

æ‰©å±•

~~~kotlin
fun receiverType.functionName(params){
    body
}

// æ‰©å±•å‡½æ•° swap,è°ƒæ¢ä¸åŒä½ç½®çš„å€¼
fun MutableList<Int>.swap(index1: Int, index2: Int) {
    val tmp = this[index1]     //  this å¯¹åº”è¯¥åˆ—è¡¨
    this[index1] = this[index2]
    this[index2] = tmp
}

fun main(args: Array<String>) {

    val l = mutableListOf(1, 2, 3)
    // ä½ç½® 0 å’Œ 2 çš„å€¼åšäº†äº’æ¢
    l.swap(0, 2) // 'swap()' å‡½æ•°å†…çš„ 'this' å°†æŒ‡å‘ 'l' çš„å€¼

    println(l.toString())
}

~~~

æ‰©å±•å‡½æ•°æ˜¯é™æ€è§£æçš„ï¼Œå¹¶ä¸æ˜¯æ¥æ”¶è€…ç±»å‹çš„è™šæ‹Ÿæˆå‘˜ï¼Œåœ¨è°ƒç”¨æ‰©å±•å‡½æ•°æ—¶ï¼Œå…·ä½“è¢«è°ƒç”¨çš„çš„æ˜¯å“ªä¸€ä¸ªå‡½æ•°ï¼Œç”±è°ƒç”¨å‡½æ•°çš„çš„å¯¹è±¡è¡¨è¾¾å¼æ¥å†³å®šçš„ï¼Œè€Œä¸æ˜¯åŠ¨æ€çš„ç±»å‹å†³å®šçš„:

```kotlin
open class C

class D: C()

fun C.foo() = "c"   // æ‰©å±•å‡½æ•° foo

fun D.foo() = "d"   // æ‰©å±•å‡½æ•° foo

fun printFoo(c: C) {
    println(c.foo())  // ç±»å‹æ˜¯ C ç±»
}

fun main(arg:Array<String>){
    printFoo(D())
}
```

å®ä¾‹æ‰§è¡Œè¾“å‡ºç»“æœä¸ºï¼š

```kotlin
c
```

è‹¥æ‰©å±•å‡½æ•°å’Œæˆå‘˜å‡½æ•°ä¸€è‡´ï¼Œåˆ™ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼Œä¼šä¼˜å…ˆä½¿ç”¨æˆå‘˜å‡½æ•°ã€‚

åœ¨æ‰©å±•å‡½æ•°å†…ï¼Œ å¯ä»¥é€šè¿‡ this æ¥åˆ¤æ–­æ¥æ”¶è€…æ˜¯å¦ä¸º NULL,è¿™æ ·ï¼Œå³ä½¿æ¥æ”¶è€…ä¸º NULL,ä¹Ÿå¯ä»¥è°ƒç”¨æ‰©å±•å‡½æ•°ã€‚

é™¤äº†å‡½æ•°ï¼ŒKotlin ä¹Ÿæ”¯æŒå±æ€§å¯¹å±æ€§è¿›è¡Œæ‰©å±•:

```
val <T> List<T>.lastIndex: Int
    get() = size - 1
 
```

æ‰©å±•å±æ€§å…è®¸å®šä¹‰åœ¨ç±»æˆ–è€…kotlinæ–‡ä»¶ä¸­ï¼Œä¸å…è®¸å®šä¹‰åœ¨å‡½æ•°ä¸­ã€‚åˆå§‹åŒ–å±æ€§å› ä¸ºå±æ€§æ²¡æœ‰åç«¯å­—æ®µï¼ˆbacking fieldï¼‰ï¼Œæ‰€ä»¥ä¸å…è®¸è¢«åˆå§‹åŒ–ï¼Œåªèƒ½ç”±æ˜¾å¼æä¾›çš„ getter/setter å®šä¹‰ã€‚

```
val Foo.bar = 1 // é”™è¯¯ï¼šæ‰©å±•å±æ€§ä¸èƒ½æœ‰åˆå§‹åŒ–å™¨
```

æ‰©å±•å±æ€§åªèƒ½è¢«å£°æ˜ä¸º val.



å¯†å°ç±»

å¯†å°ç±»å°±æ˜¯ä¸€ç§ä¸“é—¨ç”¨æ¥é…åˆ when è¯­å¥ä½¿ç”¨çš„ç±»ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚åœ¨ Android ä¸­æˆ‘ä»¬æœ‰ä¸€ä¸ª viewï¼Œæˆ‘ä»¬ç°åœ¨æƒ³é€šè¿‡ when è¯­å¥è®¾ç½®é’ˆå¯¹ view è¿›è¡Œä¸¤ç§æ“ä½œï¼šæ˜¾ç¤ºå’Œéšè—ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿™æ ·åšï¼š

```kotlin
sealed class UiOp {
    object Show: UiOp()
    object Hide: UiOp()
} 
fun execute(view: View, op: UiOp) = when (op) {
    UiOp.Show -> view.visibility = View.VISIBLE
    UiOp.Hide -> view.visibility = View.GONE
}
```

åŒ¿åå¯¹è±¡å¯ä»¥ç”¨ä½œåªåœ¨æœ¬åœ°å’Œç§æœ‰ä½œç”¨åŸŸä¸­å£°æ˜çš„ç±»å‹ã€‚å¦‚æœä½ ä½¿ç”¨åŒ¿åå¯¹è±¡ä½œä¸ºå…¬æœ‰å‡½æ•°çš„ è¿”å›ç±»å‹æˆ–è€…ç”¨ä½œå…¬æœ‰å±æ€§çš„ç±»å‹ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°æˆ–å±æ€§çš„å®é™…ç±»å‹ ä¼šæ˜¯åŒ¿åå¯¹è±¡å£°æ˜çš„è¶…ç±»å‹ï¼Œå¦‚æœä½ æ²¡æœ‰å£°æ˜ä»»ä½•è¶…ç±»å‹ï¼Œå°±ä¼šæ˜¯ Anyã€‚åœ¨åŒ¿åå¯¹è±¡ ä¸­æ·»åŠ çš„æˆå‘˜å°†æ— æ³•è®¿é—®ã€‚

```kotlin
class C {
    // ç§æœ‰å‡½æ•°ï¼Œæ‰€ä»¥å…¶è¿”å›ç±»å‹æ˜¯åŒ¿åå¯¹è±¡ç±»å‹
    private fun foo() = object {
        val x: String = "x"
    }

    // å…¬æœ‰å‡½æ•°ï¼Œæ‰€ä»¥å…¶è¿”å›ç±»å‹æ˜¯ Any
    fun publicFoo() = object {
        val x: String = "x"
    }

    fun bar() {
        val x1 = foo().x        // æ²¡é—®é¢˜
        val x2 = publicFoo().x  // é”™è¯¯ï¼šæœªèƒ½è§£æçš„å¼•ç”¨â€œxâ€
    }
}
```

å¯¹è±¡å£°æ˜åœ¨å¦ä¸€ä¸ªç±»çš„å†…éƒ¨æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å¹¶ä¸èƒ½é€šè¿‡å¤–éƒ¨ç±»çš„å®ä¾‹è®¿é—®åˆ°è¯¥å¯¹è±¡ï¼Œè€Œåªèƒ½é€šè¿‡ç±»åæ¥è®¿é—®ï¼ŒåŒæ ·è¯¥å¯¹è±¡ä¹Ÿä¸èƒ½ç›´æ¥è®¿é—®åˆ°å¤–éƒ¨ç±»çš„æ–¹æ³•å’Œå˜é‡ã€‚

```kotlin
class Site {
    var name = "èœé¸Ÿæ•™ç¨‹"
    object DeskTop{
        var url = "www.runoob.com"
        fun showName(){
            print{"desk legs $name"} // é”™è¯¯ï¼Œä¸èƒ½è®¿é—®åˆ°å¤–éƒ¨ç±»çš„æ–¹æ³•å’Œå˜é‡
        }
    }
}
fun main(args: Array<String>) {
    var site = Site()
    site.DeskTop.url // é”™è¯¯ï¼Œä¸èƒ½é€šè¿‡å¤–éƒ¨ç±»çš„å®ä¾‹è®¿é—®åˆ°è¯¥å¯¹è±¡
    Site.DeskTop.url // æ­£ç¡®
}
```

ä¼´ç”Ÿå¯¹è±¡

ç±»å†…éƒ¨çš„å¯¹è±¡å£°æ˜å¯ä»¥ç”¨ companion å…³é”®å­—æ ‡è®°ï¼Œè¿™æ ·å®ƒå°±ä¸å¤–éƒ¨ç±»å…³è”åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥é€šè¿‡å¤–éƒ¨ç±»è®¿é—®åˆ°å¯¹è±¡çš„å†…éƒ¨å…ƒç´ ã€‚

```
class MyClass {
    companion object Factory {
        fun create(): MyClass = MyClass()
    }
}

val instance = MyClass.create()   // è®¿é—®åˆ°å¯¹è±¡çš„å†…éƒ¨å…ƒç´ 
```

æˆ‘ä»¬å¯ä»¥çœç•¥æ‰è¯¥å¯¹è±¡çš„å¯¹è±¡åï¼Œç„¶åä½¿ç”¨ Companion æ›¿ä»£éœ€è¦å£°æ˜çš„å¯¹è±¡åï¼š

```
class MyClass {
    companion object {
    }
}

val x = MyClass.Companion
```

**æ³¨æ„ï¼š**ä¸€ä¸ªç±»é‡Œé¢åªèƒ½å£°æ˜ä¸€ä¸ªå†…éƒ¨å…³è”å¯¹è±¡ï¼Œå³å…³é”®å­— companion åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚

å§”æ‰˜ï¼š





##  ç¬¬ä¸‰ä¸ªæœˆï¼š 

### 1ã€ç†Ÿæ‚‰å„ä¸ªæ¨¡å—çš„ä¸šåŠ¡ï¼ŒåŒ…å«å”®å‰ã€å”®ä¸­ã€å”®åç­‰æ¨¡å—ä¸šåŠ¡ 

### 2ã€ç†Ÿæ‚‰éœ€æ±‚å¼€å‘æµç¨‹ï¼Œç†Ÿæ‚‰Meegoã€Marsenalã€Figmaå¹³å°ä½¿ç”¨æµç¨‹ï¼Œè¿›è¡Œä¸€ä¸ªå°éœ€æ±‚å¼€å‘ 

### 3ã€æ•´ç†å­¦ä¹ ç¬”è®°å¹¶æ€»ç»“å¿ƒå¾—ä½“ä¼š

